<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>riemann.core documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Riemann 0.2.7 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>riemann</span></div></div></li><li class="depth-2 branch"><a href="riemann.bin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bin</span></div></a></li><li class="depth-2 branch"><a href="riemann.blueflood.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>blueflood</span></div></a></li><li class="depth-2 branch"><a href="riemann.campfire.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>campfire</span></div></a></li><li class="depth-2 branch"><a href="riemann.cloudwatch.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cloudwatch</span></div></a></li><li class="depth-2 branch"><a href="riemann.common.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></a></li><li class="depth-2 branch"><a href="riemann.config.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-2 branch current"><a href="riemann.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="riemann.datadog.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datadog</span></div></a></li><li class="depth-2 branch"><a href="riemann.deps.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>deps</span></div></a></li><li class="depth-2 branch"><a href="riemann.email.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>email</span></div></a></li><li class="depth-2 branch"><a href="riemann.folds.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>folds</span></div></a></li><li class="depth-2 branch"><a href="riemann.graphite.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>graphite</span></div></a></li><li class="depth-2 branch"><a href="riemann.hipchat.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hipchat</span></div></a></li><li class="depth-2 branch"><a href="riemann.index.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>index</span></div></a></li><li class="depth-2 branch"><a href="riemann.influxdb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>influxdb</span></div></a></li><li class="depth-2 branch"><a href="riemann.instrumentation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>instrumentation</span></div></a></li><li class="depth-2 branch"><a href="riemann.kairosdb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>kairosdb</span></div></a></li><li class="depth-2 branch"><a href="riemann.librato.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>librato</span></div></a></li><li class="depth-2 branch"><a href="riemann.logentries.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logentries</span></div></a></li><li class="depth-2 branch"><a href="riemann.logging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logging</span></div></a></li><li class="depth-2 branch"><a href="riemann.logstash.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logstash</span></div></a></li><li class="depth-2 branch"><a href="riemann.mailgun.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mailgun</span></div></a></li><li class="depth-2 branch"><a href="riemann.nagios.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nagios</span></div></a></li><li class="depth-2 branch"><a href="riemann.opentsdb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>opentsdb</span></div></a></li><li class="depth-2 branch"><a href="riemann.opsgenie.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>opsgenie</span></div></a></li><li class="depth-2 branch"><a href="riemann.pagerduty.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pagerduty</span></div></a></li><li class="depth-2 branch"><a href="riemann.plugin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>plugin</span></div></a></li><li class="depth-2 branch"><a href="riemann.pool.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pool</span></div></a></li><li class="depth-2 branch"><a href="riemann.pubsub.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pubsub</span></div></a></li><li class="depth-2 branch"><a href="riemann.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-2 branch"><a href="riemann.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch"><a href="riemann.service.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>service</span></div></a></li><li class="depth-2 branch"><a href="riemann.shinken.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shinken</span></div></a></li><li class="depth-2 branch"><a href="riemann.slack.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>slack</span></div></a></li><li class="depth-2 branch"><a href="riemann.sns.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sns</span></div></a></li><li class="depth-2 branch"><a href="riemann.stackdriver.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stackdriver</span></div></a></li><li class="depth-2 branch"><a href="riemann.streams.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>streams</span></div></a></li><li class="depth-2 branch"><a href="riemann.test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-2"><a href="riemann.time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>time</span></div></a></li><li class="depth-3"><a href="riemann.time.controlled.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>controlled</span></div></a></li><li class="depth-2"><a href="riemann.transport.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>transport</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.debug.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debug</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.graphite.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>graphite</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.opentsdb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>opentsdb</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.sse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sse</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.tcp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tcp</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.udp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>udp</span></div></a></li><li class="depth-3"><a href="riemann.transport.websockets.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>websockets</span></div></a></li><li class="depth-2 branch"><a href="riemann.twilio.html"><div class="inner"><span class="tree" style="top: -238px;"><span class="top" style="height: 247px;"></span><span class="bottom"></span></span><span>twilio</span></div></a></li><li class="depth-2"><a href="riemann.xymon.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>xymon</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="riemann.core.html#var--.3ECore"><div class="inner"><span>-&gt;Core</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-conj-service"><div class="inner"><span>conj-service</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-core"><div class="inner"><span>core</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-core-services"><div class="inner"><span>core-services</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-delete-from-index"><div class="inner"><span>delete-from-index</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-instrumentation-service"><div class="inner"><span>instrumentation-service</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-map-.3ECore"><div class="inner"><span>map-&gt;Core</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-merge-cores"><div class="inner"><span>merge-cores</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-reaper"><div class="inner"><span>reaper</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-start.21"><div class="inner"><span>start!</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-stop.21"><div class="inner"><span>stop!</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-stream.21"><div class="inner"><span>stream!</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-transition.21"><div class="inner"><span>transition!</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-update-index"><div class="inner"><span>update-index</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-wrap-index"><div class="inner"><span>wrap-index</span></div></a></li><li class="depth-1"><a href="riemann.core.html#var-WrappedIndex"><div class="inner"><span>WrappedIndex</span></div></a></li><li class="depth-2"><a href="riemann.core.html#var-source"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>source</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">riemann.core</h2><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var--.3ECore"><h3>-&gt;Core</h3><div class="usage"><code>(-&gt;Core streams services index pubsub streaming-metric)</code></div><div class="doc"><div class="markdown"><p>Positional factory function for class riemann.core.Core.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L64">view source</a></div></div><div class="public anchor" id="var-conj-service"><h3>conj-service</h3><div class="usage"><code>(conj-service core service)</code><code>(conj-service core service force?)</code></div><div class="doc"><div class="markdown"><p>Adds a service to a core. Throws if any existing services would conflict. If force? is passed, dissoc&rsquo;s any conflicting services.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L81">view source</a></div></div><div class="public anchor" id="var-core"><h3>core</h3><div class="usage"><code>(core)</code></div><div class="doc"><div class="markdown"><p>Create a new core.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L71">view source</a></div></div><div class="public anchor" id="var-core-services"><h3>core-services</h3><div class="usage"><code>(core-services core)</code></div><div class="doc"><div class="markdown"><p>All services in a core&ndash;both the :services list and named services like the index.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L21">view source</a></div></div><div class="public anchor" id="var-delete-from-index"><h3>delete-from-index</h3><div class="usage"><code>(delete-from-index core event)</code><code>(delete-from-index core fields event)</code></div><div class="doc"><div class="markdown"><p>Deletes similar events from the index. By default, deletes events with the same host and service. If a field, or a list of fields, is given, deletes any events with matching values for all of those fields.</p><p>; Delete all events in the index with the same host (delete-from-index index :host event)</p><p>; Delete all events in the index with the same host and state. (delete-from-index index [:host :state] event)</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L250">view source</a></div></div><div class="public anchor" id="var-instrumentation-service"><h3>instrumentation-service</h3><div class="usage"><code>(instrumentation-service opts)</code></div><div class="doc"><div class="markdown"><p>Returns a service which samples instrumented services in its core every interval seconds, and sends their events to the core itself.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L30">view source</a></div></div><div class="public anchor" id="var-map-.3ECore"><h3>map-&gt;Core</h3><div class="usage"><code>(map-&gt;Core m__5869__auto__)</code></div><div class="doc"><div class="markdown"><p>Factory function for class riemann.core.Core, taking a map of keywords to field values.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L64">view source</a></div></div><div class="public anchor" id="var-merge-cores"><h3>merge-cores</h3><div class="usage"><code>(merge-cores old-core new-core)</code></div><div class="doc"><div class="markdown"><p>Merge cores old-core and new-core into a new core comprised of services from :new-core or their equivalents from :old-core where possible.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L103">view source</a></div></div><div class="public anchor" id="var-reaper"><h3>reaper</h3><div class="usage"><code>(reaper)</code><code>(reaper interval)</code><code>(reaper interval opts)</code></div><div class="doc"><div class="markdown"><p>Returns a service which expires states from its core&rsquo;s index every interval (default 10) seconds. Expired events are streamed to the core&rsquo;s streams. The streamed states have only the host and service copied, current time, and state expired. Expired events from the index are also published to the &ldquo;index&rdquo; pubsub channel.</p><p>Options:</p><p>:keep-keys A list of event keys which should be preserved from the indexed  event in the expired event. Defaults to [:host :service], which  means that when an event expires, its :host and :service are  copied to a new event, but no other keys are preserved.</p>
<pre><code>       The state of an expired event is always &quot;expired&quot;, and its time
       is always the time that the event expired.
</code></pre></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L269">view source</a></div></div><div class="public anchor" id="var-start.21"><h3>start!</h3><div class="usage"><code>(start! core)</code></div><div class="doc"><div class="markdown"><p>Start the given core. Reloads and starts all services.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L161">view source</a></div></div><div class="public anchor" id="var-stop.21"><h3>stop!</h3><div class="usage"><code>(stop! core)</code></div><div class="doc"><div class="markdown"><p>Stops the given core and all services.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L169">view source</a></div></div><div class="public anchor" id="var-stream.21"><h3>stream!</h3><div class="usage"><code>(stream! core event)</code></div><div class="doc"><div class="markdown"><p>Applies an event to the streams in this core.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L14">view source</a></div></div><div class="public anchor" id="var-transition.21"><h3>transition!</h3><div class="usage"><code>(transition! old-core new-core)</code></div><div class="doc"><div class="markdown"><p>A core transition &ldquo;merges&rdquo; one core into another. Cores are immutable, but the stateful resources associated with them aren&rsquo;t. When you call (transition! old-core new-core), we:</p>
<ol>
  <li><p>Stop old core services without an equivalent in the new core.</p></li>
  <li><p>Merge the new core&rsquo;s services with equivalents from the old core.</p></li>
  <li><p>Reload all services with the merged core.</p></li>
  <li><p>Start all services in the merged core.</p></li>
</ol><p>Finally, we return the merged core. old-core and new-core can be discarded.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L129">view source</a></div></div><div class="public anchor" id="var-update-index"><h3>update-index</h3><div class="usage"><code>(update-index core event)</code></div><div class="doc"><div class="markdown"><p>Updates this core&rsquo;s index with an event.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L176">view source</a></div></div><div class="public anchor" id="var-wrap-index"><h3>wrap-index</h3><div class="usage"><code>(wrap-index source)</code><code>(wrap-index source registry)</code></div><div class="doc"><div class="markdown"><p>Wraps an index, exposing the normal Index and IFn protocols. If a second argument is present it should implement the PubSub interface and will be notified when events are updated in the index.</p></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L192">view source</a></div></div><div class="public anchor" id="var-WrappedIndex"><h3>WrappedIndex</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-source"><h3>source</h3><div class="usage"><code>(source this)</code></div><div class="doc"><div class="markdown"></div></div></div></div></div><div class="src-link"><a href="http://github.com/aphyr/riemann/blob/master/src/riemann/core.clj#L184">view source</a></div></div></div></body></html>