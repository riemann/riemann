<!DOCTYPE html PUBLIC ""
    "">

<html><head><meta charset="UTF-8" /><title>riemann.service documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Riemann</span> <span class="project-version">0.3.12</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>riemann</span></div></div></li><li class="depth-2 branch"><a href="riemann.bin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bin</span></div></a></li><li class="depth-2 branch"><a href="riemann.blueflood.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>blueflood</span></div></a></li><li class="depth-2 branch"><a href="riemann.boundary.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>boundary</span></div></a></li><li class="depth-2 branch"><a href="riemann.clickhouse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clickhouse</span></div></a></li><li class="depth-2 branch"><a href="riemann.cloudwatch.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cloudwatch</span></div></a></li><li class="depth-2 branch"><a href="riemann.common.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></a></li><li class="depth-2 branch"><a href="riemann.config.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-2 branch"><a href="riemann.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="riemann.datadog.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datadog</span></div></a></li><li class="depth-2 branch"><a href="riemann.deps.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>deps</span></div></a></li><li class="depth-2 branch"><a href="riemann.druid.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>druid</span></div></a></li><li class="depth-2 branch"><a href="riemann.elasticsearch.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>elasticsearch</span></div></a></li><li class="depth-2 branch"><a href="riemann.email.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>email</span></div></a></li><li class="depth-2 branch"><a href="riemann.expiration.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>expiration</span></div></a></li><li class="depth-2 branch"><a href="riemann.folds.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>folds</span></div></a></li><li class="depth-2 branch"><a href="riemann.graphite.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>graphite</span></div></a></li><li class="depth-2 branch"><a href="riemann.hipchat.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hipchat</span></div></a></li><li class="depth-2 branch"><a href="riemann.index.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>index</span></div></a></li><li class="depth-2 branch"><a href="riemann.influxdb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>influxdb</span></div></a></li><li class="depth-2 branch"><a href="riemann.influxdb2.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>influxdb2</span></div></a></li><li class="depth-2 branch"><a href="riemann.instrumentation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>instrumentation</span></div></a></li><li class="depth-2 branch"><a href="riemann.kafka.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>kafka</span></div></a></li><li class="depth-2 branch"><a href="riemann.kairosdb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>kairosdb</span></div></a></li><li class="depth-2 branch"><a href="riemann.keenio.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>keenio</span></div></a></li><li class="depth-2 branch"><a href="riemann.librato.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>librato</span></div></a></li><li class="depth-2 branch"><a href="riemann.logentries.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logentries</span></div></a></li><li class="depth-2 branch"><a href="riemann.logging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logging</span></div></a></li><li class="depth-2 branch"><a href="riemann.logstash.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logstash</span></div></a></li><li class="depth-2 branch"><a href="riemann.mailgun.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mailgun</span></div></a></li><li class="depth-2 branch"><a href="riemann.msteams.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>msteams</span></div></a></li><li class="depth-2 branch"><a href="riemann.nagios.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nagios</span></div></a></li><li class="depth-2 branch"><a href="riemann.netuitive.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>netuitive</span></div></a></li><li class="depth-2 branch"><a href="riemann.opentsdb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>opentsdb</span></div></a></li><li class="depth-2 branch"><a href="riemann.opsgenie.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>opsgenie</span></div></a></li><li class="depth-2 branch"><a href="riemann.pagerduty.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pagerduty</span></div></a></li><li class="depth-2 branch"><a href="riemann.plugin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>plugin</span></div></a></li><li class="depth-2 branch"><a href="riemann.pool.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pool</span></div></a></li><li class="depth-2 branch"><a href="riemann.prometheus.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>prometheus</span></div></a></li><li class="depth-2 branch"><a href="riemann.pubsub.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pubsub</span></div></a></li><li class="depth-2 branch"><a href="riemann.pushover.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pushover</span></div></a></li><li class="depth-2 branch"><a href="riemann.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-2 branch"><a href="riemann.rabbitmq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rabbitmq</span></div></a></li><li class="depth-2 branch"><a href="riemann.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch current"><a href="riemann.service.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>service</span></div></a></li><li class="depth-2 branch"><a href="riemann.shinken.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shinken</span></div></a></li><li class="depth-2 branch"><a href="riemann.slack.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>slack</span></div></a></li><li class="depth-2 branch"><a href="riemann.sns.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sns</span></div></a></li><li class="depth-2 branch"><a href="riemann.stackdriver.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stackdriver</span></div></a></li><li class="depth-2"><a href="riemann.streams.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>streams</span></div></a></li><li class="depth-3"><a href="riemann.streams.pure.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pure</span></div></a></li><li class="depth-2 branch"><a href="riemann.telegram.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>telegram</span></div></a></li><li class="depth-2 branch"><a href="riemann.test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-2"><a href="riemann.time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>time</span></div></a></li><li class="depth-3"><a href="riemann.time.controlled.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>controlled</span></div></a></li><li class="depth-2"><a href="riemann.transport.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>transport</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.debug.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debug</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.graphite.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>graphite</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.opentsdb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>opentsdb</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.rabbitmq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rabbitmq</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.sse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sse</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.tcp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tcp</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.udp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>udp</span></div></a></li><li class="depth-3"><a href="riemann.transport.websockets.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>websockets</span></div></a></li><li class="depth-2 branch"><a href="riemann.twilio.html"><div class="inner"><span class="tree" style="top: -269px;"><span class="top" style="height: 278px;"></span><span class="bottom"></span></span><span>twilio</span></div></a></li><li class="depth-2 branch"><a href="riemann.victorops.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>victorops</span></div></a></li><li class="depth-2 branch"><a href="riemann.xymon.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>xymon</span></div></a></li><li class="depth-2"><a href="riemann.zabbix.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>zabbix</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="riemann.service.html#var-all-equal.3F"><div class="inner"><span>all-equal?</span></div></a></li><li class="depth-1"><a href="riemann.service.html#var-executor-service"><div class="inner"><span>executor-service</span></div></a></li><li class="depth-1"><a href="riemann.service.html#var-IExecutorServiceService"><div class="inner"><span>IExecutorServiceService</span></div></a></li><li class="depth-2"><a href="riemann.service.html#var-getExecutor"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>getExecutor</span></div></a></li><li class="depth-1"><a href="riemann.service.html#var-literal-executor-service"><div class="inner"><span>literal-executor-service</span></div></a></li><li class="depth-1"><a href="riemann.service.html#var-scheduled-task-service"><div class="inner"><span>scheduled-task-service</span></div></a></li><li class="depth-1"><a href="riemann.service.html#var-Service"><div class="inner"><span>Service</span></div></a></li><li class="depth-2 branch"><a href="riemann.service.html#var-conflict.3F"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>conflict?</span></div></a></li><li class="depth-2 branch"><a href="riemann.service.html#var-reload.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>reload!</span></div></a></li><li class="depth-2 branch"><a href="riemann.service.html#var-start.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>start!</span></div></a></li><li class="depth-2"><a href="riemann.service.html#var-stop.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stop!</span></div></a></li><li class="depth-1"><a href="riemann.service.html#var-ServiceEquiv"><div class="inner"><span>ServiceEquiv</span></div></a></li><li class="depth-2"><a href="riemann.service.html#var-equiv.3F"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>equiv?</span></div></a></li><li class="depth-1"><a href="riemann.service.html#var-ServiceStatus"><div class="inner"><span>ServiceStatus</span></div></a></li><li class="depth-2"><a href="riemann.service.html#var-running.3F"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>running?</span></div></a></li><li class="depth-1"><a href="riemann.service.html#var-thread-service"><div class="inner"><span>thread-service</span></div></a></li><li class="depth-1"><a href="riemann.service.html#var-threadpool-service"><div class="inner"><span>threadpool-service</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">riemann.service</h1><div class="doc"><div class="markdown"><p>Lifecycle protocol for stateful services bound to a core.</p>
</div></div><div class="public anchor" id="var-all-equal.3F"><h3>all-equal?</h3><h4 class="type">macro</h4><div class="usage"><code>(all-equal? a b &amp; forms)</code></div><div class="doc"><div class="markdown"><p>Takes two objects to compare and a list of forms to compare them by.</p>
<pre><code class="language-clojure">(all-equiv? foo bar
  (class)
  (foo 2)
  (.getSize))
</code></pre>
<p>becomes</p>
<pre><code class="language-clojure">(let [a foo
      b bar]
  (and (= (class a) (class b))
       (= (foo 2 a) (foo 2 b))
       (= (.getSize a) (.getSize b))))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/service.clj#L135">view source</a></div></div><div class="public anchor" id="var-executor-service"><h3>executor-service</h3><div class="usage"><code>(executor-service name f)</code><code>(executor-service name equiv-key f)</code></div><div class="doc"><div class="markdown"><p>Creates a new threadpool executor service … service! Takes a function which generates an ExecutorService. Returns an ExecutorServiceService which provides start/stop/reload/equiv? lifecycle management of that service.</p>
<p>Equivalence-key controls how services are compared to tell if they are equivalent. Services with a nil equivalence key are <em>never</em> equivalent. Otherwise, services are equivalent when their class, name, and equiv-key are equal.</p>
<pre><code class="language-clojure">(executor-service* :graphite {foo: 4}
  #(ThreadPoolExecutor. 2 ...))
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/service.clj#L304">view source</a></div></div><div class="public anchor" id="var-IExecutorServiceService"><h3>IExecutorServiceService</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-getExecutor"><h3>getExecutor</h3><div class="usage"><code>(getExecutor this)</code></div><div class="doc"><div class="markdown"></div></div></div></div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/service.clj#L164">view source</a></div></div><div class="public anchor" id="var-literal-executor-service"><h3>literal-executor-service</h3><h4 class="type">macro</h4><div class="usage"><code>(literal-executor-service name executor-service-expr)</code></div><div class="doc"><div class="markdown"><p>Like executor-service, but captures the <em>expression</em> passed to it as the equivalence key. This only works if the expression is literal; if there are any variables or function calls, they will be compared as code, not as their evaluated values.</p>
<ul>
<li>OK:  (literal-executor-service :io (ThreadPoolExecutor. 2 …))</li>
<li>OK:  (literal-executor-service :io (ThreadPoolExecutor. (inc 1) …))</li>
<li>BAD: (literal-executor-service :io (ThreadPoolExecutor. x …))</li>
</ul>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/service.clj#L322">view source</a></div></div><div class="public anchor" id="var-scheduled-task-service"><h3>scheduled-task-service</h3><div class="usage"><code>(scheduled-task-service name equiv-key interval delay f)</code></div><div class="doc"><div class="markdown"><p>Returns a ScheduledTaskService which will schedule a task which call (f core) repeatedly every <code>interval</code> after <code>delay</code> seconds. Equivalent to other ScheduledTaskService with the same <code>name</code>, <code>equiv-key</code>, <code>delay</code> and <code>interval</code>. Conflicts with other ScheduledTaskService of the same name.</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/service.clj#L126">view source</a></div></div><div class="public anchor" id="var-Service"><h3>Service</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Services are components of a core with a managed lifecycle. They’re used for stateful things like connection pools, network servers, and background threads.</p>
</div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-conflict.3F"><h3>conflict?</h3><div class="usage"><code>(conflict? service1 service2)</code></div><div class="doc"><div class="markdown"><p>Do these two services conflict with one another? Adding a service to a core <em>replaces</em> any conflicting services.</p>
</div></div></div><div class="public anchor" id="var-reload.21"><h3>reload!</h3><div class="usage"><code>(reload! service core)</code></div><div class="doc"><div class="markdown"><p>Informs the service of a change in core.</p>
</div></div></div><div class="public anchor" id="var-start.21"><h3>start!</h3><div class="usage"><code>(start! service)</code></div><div class="doc"><div class="markdown"><p>Starts a service. Must be idempotent.</p>
</div></div></div><div class="public anchor" id="var-stop.21"><h3>stop!</h3><div class="usage"><code>(stop! service)</code></div><div class="doc"><div class="markdown"><p>Stops a service. Must be idempotent.</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/service.clj#L15">view source</a></div></div><div class="public anchor" id="var-ServiceEquiv"><h3>ServiceEquiv</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-equiv.3F"><h3>equiv?</h3><div class="usage"><code>(equiv? service1 service2)</code></div><div class="doc"><div class="markdown"><p>Used to identify which services can remain running through a core transition, like reloading. If the old service is equivalent to the new service, the old service may be preserved and used by the new core. Otherwise, the old service may be shut down and replaced by the new.</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/service.clj#L29">view source</a></div></div><div class="public anchor" id="var-ServiceStatus"><h3>ServiceStatus</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-running.3F"><h3>running?</h3><div class="usage"><code>(running? service)</code></div><div class="doc"><div class="markdown"><p>Queries the running state of the service.</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/service.clj#L42">view source</a></div></div><div class="public anchor" id="var-thread-service"><h3>thread-service</h3><div class="usage"><code>(thread-service name f)</code><code>(thread-service name equiv-key f)</code></div><div class="doc"><div class="markdown"><p>Returns a ThreadService which will call (f core) repeatedly when started. Will only stop between calls to f. Start and stop are blocking operations. Equivalent to other ThreadServices with the same name and equivalence key– if not provided, defaults nil. Conflicts with other ThreadServices of the same name.</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/service.clj#L115">view source</a></div></div><div class="public anchor" id="var-threadpool-service"><h3>threadpool-service</h3><div class="usage"><code>(threadpool-service name)</code><code>(threadpool-service name {:keys [core-pool-size max-pool-size keep-alive-time keep-alive-unit queue-size], :as opts, :or {core-pool-size 1, max-pool-size 128, keep-alive-time 10, keep-alive-unit TimeUnit/MILLISECONDS, queue-size 1000}})</code></div><div class="doc"><div class="markdown"><p>An ExecutorServiceService based on a ThreadPoolExecutor with core and maximum threadpool sizes, and a LinkedBlockingQueue of a given size. Options:</p>
<ul>
<li>:core-pool-size             Default 1</li>
<li>:max-pool-size              Default 128</li>
<li>:keep-alive-time            Default 10</li>
<li>:keep-alive-unit            Default MILLISECONDS</li>
<li>:queue-size                 Default 1000</li>
</ul>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/service.clj#L337">view source</a></div></div></div></body></html>