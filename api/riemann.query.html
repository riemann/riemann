<!DOCTYPE html PUBLIC ""
    "">

<html><head><meta charset="UTF-8" /><title>riemann.query documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Riemann</span> <span class="project-version">0.3.12</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>riemann</span></div></div></li><li class="depth-2 branch"><a href="riemann.bin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bin</span></div></a></li><li class="depth-2 branch"><a href="riemann.blueflood.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>blueflood</span></div></a></li><li class="depth-2 branch"><a href="riemann.boundary.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>boundary</span></div></a></li><li class="depth-2 branch"><a href="riemann.clickhouse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clickhouse</span></div></a></li><li class="depth-2 branch"><a href="riemann.cloudwatch.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cloudwatch</span></div></a></li><li class="depth-2 branch"><a href="riemann.common.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></a></li><li class="depth-2 branch"><a href="riemann.config.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-2 branch"><a href="riemann.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="riemann.datadog.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>datadog</span></div></a></li><li class="depth-2 branch"><a href="riemann.deps.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>deps</span></div></a></li><li class="depth-2 branch"><a href="riemann.druid.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>druid</span></div></a></li><li class="depth-2 branch"><a href="riemann.elasticsearch.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>elasticsearch</span></div></a></li><li class="depth-2 branch"><a href="riemann.email.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>email</span></div></a></li><li class="depth-2 branch"><a href="riemann.expiration.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>expiration</span></div></a></li><li class="depth-2 branch"><a href="riemann.folds.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>folds</span></div></a></li><li class="depth-2 branch"><a href="riemann.graphite.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>graphite</span></div></a></li><li class="depth-2 branch"><a href="riemann.hipchat.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hipchat</span></div></a></li><li class="depth-2 branch"><a href="riemann.index.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>index</span></div></a></li><li class="depth-2 branch"><a href="riemann.influxdb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>influxdb</span></div></a></li><li class="depth-2 branch"><a href="riemann.influxdb2.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>influxdb2</span></div></a></li><li class="depth-2 branch"><a href="riemann.instrumentation.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>instrumentation</span></div></a></li><li class="depth-2 branch"><a href="riemann.kafka.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>kafka</span></div></a></li><li class="depth-2 branch"><a href="riemann.kairosdb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>kairosdb</span></div></a></li><li class="depth-2 branch"><a href="riemann.keenio.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>keenio</span></div></a></li><li class="depth-2 branch"><a href="riemann.librato.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>librato</span></div></a></li><li class="depth-2 branch"><a href="riemann.logentries.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logentries</span></div></a></li><li class="depth-2 branch"><a href="riemann.logging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logging</span></div></a></li><li class="depth-2 branch"><a href="riemann.logstash.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logstash</span></div></a></li><li class="depth-2 branch"><a href="riemann.mailgun.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mailgun</span></div></a></li><li class="depth-2 branch"><a href="riemann.msteams.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>msteams</span></div></a></li><li class="depth-2 branch"><a href="riemann.nagios.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nagios</span></div></a></li><li class="depth-2 branch"><a href="riemann.netuitive.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>netuitive</span></div></a></li><li class="depth-2 branch"><a href="riemann.opentsdb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>opentsdb</span></div></a></li><li class="depth-2 branch"><a href="riemann.opsgenie.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>opsgenie</span></div></a></li><li class="depth-2 branch"><a href="riemann.pagerduty.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pagerduty</span></div></a></li><li class="depth-2 branch"><a href="riemann.plugin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>plugin</span></div></a></li><li class="depth-2 branch"><a href="riemann.pool.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pool</span></div></a></li><li class="depth-2 branch"><a href="riemann.prometheus.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>prometheus</span></div></a></li><li class="depth-2 branch"><a href="riemann.pubsub.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pubsub</span></div></a></li><li class="depth-2 branch"><a href="riemann.pushover.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pushover</span></div></a></li><li class="depth-2 branch current"><a href="riemann.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-2 branch"><a href="riemann.rabbitmq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rabbitmq</span></div></a></li><li class="depth-2 branch"><a href="riemann.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch"><a href="riemann.service.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>service</span></div></a></li><li class="depth-2 branch"><a href="riemann.shinken.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>shinken</span></div></a></li><li class="depth-2 branch"><a href="riemann.slack.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>slack</span></div></a></li><li class="depth-2 branch"><a href="riemann.sns.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sns</span></div></a></li><li class="depth-2 branch"><a href="riemann.stackdriver.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stackdriver</span></div></a></li><li class="depth-2"><a href="riemann.streams.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>streams</span></div></a></li><li class="depth-3"><a href="riemann.streams.pure.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pure</span></div></a></li><li class="depth-2 branch"><a href="riemann.telegram.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>telegram</span></div></a></li><li class="depth-2 branch"><a href="riemann.test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-2"><a href="riemann.time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>time</span></div></a></li><li class="depth-3"><a href="riemann.time.controlled.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>controlled</span></div></a></li><li class="depth-2"><a href="riemann.transport.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>transport</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.debug.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debug</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.graphite.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>graphite</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.opentsdb.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>opentsdb</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.rabbitmq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rabbitmq</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.sse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sse</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.tcp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tcp</span></div></a></li><li class="depth-3 branch"><a href="riemann.transport.udp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>udp</span></div></a></li><li class="depth-3"><a href="riemann.transport.websockets.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>websockets</span></div></a></li><li class="depth-2 branch"><a href="riemann.twilio.html"><div class="inner"><span class="tree" style="top: -269px;"><span class="top" style="height: 278px;"></span><span class="bottom"></span></span><span>twilio</span></div></a></li><li class="depth-2 branch"><a href="riemann.victorops.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>victorops</span></div></a></li><li class="depth-2 branch"><a href="riemann.xymon.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>xymon</span></div></a></li><li class="depth-2"><a href="riemann.zabbix.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>zabbix</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="riemann.query.html#var-antlr-.3East"><div class="inner"><span>antlr-&gt;ast</span></div></a></li><li class="depth-1"><a href="riemann.query.html#var-antlr-parser"><div class="inner"><span>antlr-parser</span></div></a></li><li class="depth-1"><a href="riemann.query.html#var-ast"><div class="inner"><span>ast</span></div></a></li><li class="depth-1"><a href="riemann.query.html#var-ast-predicate"><div class="inner"><span>ast-predicate</span></div></a></li><li class="depth-1"><a href="riemann.query.html#var-ast-prefix"><div class="inner"><span>ast-prefix</span></div></a></li><li class="depth-1"><a href="riemann.query.html#var-ast-regex"><div class="inner"><span>ast-regex</span></div></a></li><li class="depth-1"><a href="riemann.query.html#var-clj-ast"><div class="inner"><span>clj-ast</span></div></a></li><li class="depth-1"><a href="riemann.query.html#var-clj-ast-field"><div class="inner"><span>clj-ast-field</span></div></a></li><li class="depth-1"><a href="riemann.query.html#var-clj-ast-guarded-prefix"><div class="inner"><span>clj-ast-guarded-prefix</span></div></a></li><li class="depth-1"><a href="riemann.query.html#var-clj-ast-regex-match"><div class="inner"><span>clj-ast-regex-match</span></div></a></li><li class="depth-1"><a href="riemann.query.html#var-clj-ast-tagged"><div class="inner"><span>clj-ast-tagged</span></div></a></li><li class="depth-1"><a href="riemann.query.html#var-fun"><div class="inner"><span>fun</span></div></a></li><li class="depth-1"><a href="riemann.query.html#var-fun-cache"><div class="inner"><span>fun-cache</span></div></a></li><li class="depth-1"><a href="riemann.query.html#var-make-regex"><div class="inner"><span>make-regex</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">riemann.query</h1><div class="doc"><div class="markdown"><p>The query parser. Parses strings into ASTs, and converts ASTs to functions which match events.</p>
</div></div><div class="public anchor" id="var-antlr-.3East"><h3>antlr-&gt;ast</h3><div class="usage"><code>(antlr-&gt;ast [node-type &amp; terms])</code></div><div class="doc"><div class="markdown"><p>Converts a parse tree to an intermediate AST which is a little easier to analyze and work with. This is the AST we use for optimization and which is passed to various query compilers. Turns literals into their equivalent JVM types, and eliminates some unnecessary parser structure.</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L64">view source</a></div></div><div class="public anchor" id="var-antlr-parser"><h3>antlr-parser</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L10">view source</a></div></div><div class="public anchor" id="var-ast"><h3>ast</h3><div class="usage"><code>(ast string)</code></div><div class="doc"><div class="markdown"><p>Takes a string to a general AST.</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L115">view source</a></div></div><div class="public anchor" id="var-ast-predicate"><h3>ast-predicate</h3><div class="usage"><code>(ast-predicate terms)</code></div><div class="doc"><div class="markdown"><p>Rewrites predicates with and/or/not to normal Clojure forms.</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L14">view source</a></div></div><div class="public anchor" id="var-ast-prefix"><h3>ast-prefix</h3><div class="usage"><code>(ast-prefix sym [t1 _ t2])</code></div><div class="doc"><div class="markdown"><p>Rewrites binary expressions from infix to prefix. Takes a symbol <code>(e.g. '=)</code> and a 3-element seq like <code>(1 "=" 2)</code> and emits <code>(= 1 2)</code>, ignoring the middle term and transforming t1 and t2.</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L43">view source</a></div></div><div class="public anchor" id="var-ast-regex"><h3>ast-regex</h3><div class="usage"><code>(ast-regex type [string _ pattern])</code></div><div class="doc"><div class="markdown"><p>Takes a type of match (:like or :regex), a list of three string terms: an AST resolving to a string, the literal =~ (ignored), and a pattern. Returns <code>(:regex pattern string-ast)</code>.</p>
<p>For :regex matches, emits a regular expression pattern. For :like matches, emits a string pattern.</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L50">view source</a></div></div><div class="public anchor" id="var-clj-ast"><h3>clj-ast</h3><div class="usage"><code>(clj-ast ast)</code></div><div class="doc"><div class="markdown"><p>Rewrites an AST to eval-able Clojure forms.</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L167">view source</a></div></div><div class="public anchor" id="var-clj-ast-field"><h3>clj-ast-field</h3><div class="usage"><code>(clj-ast-field field)</code></div><div class="doc"><div class="markdown"><p>Takes a keyword field name and emits an expression to extract that field from an ’event map, e.g. <code>(:fieldname event)</code>.</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L134">view source</a></div></div><div class="public anchor" id="var-clj-ast-guarded-prefix"><h3>clj-ast-guarded-prefix</h3><div class="usage"><code>(clj-ast-guarded-prefix f check [a b])</code></div><div class="doc"><div class="markdown"><p>Like prefix, but inserts a predicate check around both terms.</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L124">view source</a></div></div><div class="public anchor" id="var-clj-ast-regex-match"><h3>clj-ast-regex-match</h3><div class="usage"><code>(clj-ast-regex-match pattern-transformer [pattern field])</code></div><div class="doc"><div class="markdown"><p>Takes a pattern transformer, and a list of <a href="pattern string-ast">pattern string-ast</a>, and emits code to match the string-ast’s results with a regex match, compiling pattern with pattern-transformer.</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L157">view source</a></div></div><div class="public anchor" id="var-clj-ast-tagged"><h3>clj-ast-tagged</h3><div class="usage"><code>(clj-ast-tagged tag)</code></div><div class="doc"><div class="markdown"><p>Takes a tag and emits an expression to match that tag in an event.</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L140">view source</a></div></div><div class="public anchor" id="var-fun"><h3>fun</h3><div class="usage"><code>(fun ast)</code></div><div class="doc"><div class="markdown"><p>Transforms an AST into a fn <a href="event">event</a> which returns true if the query matches that event. Example:</p>
<pre><code class="language-clojure">(def q (fun (ast "metric &gt; 2")))
(q {:metric 1}) =&gt; false
(q {:metric 3}) =&gt; true
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L198">view source</a></div></div><div class="public anchor" id="var-fun-cache"><h3>fun-cache</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Speeds up the compilation of queries by caching map of ASTs to corresponding functions.</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L193">view source</a></div></div><div class="public anchor" id="var-make-regex"><h3>make-regex</h3><div class="usage"><code>(make-regex string)</code></div><div class="doc"><div class="markdown"><p>Convert a string like “foo%” into /^foo.*$/</p>
</div></div><div class="src-link"><a href="https://github.com/riemann/riemann/blob/0.3.12/src/riemann/query.clj#L146">view source</a></div></div></div></body></html>